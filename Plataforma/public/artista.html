<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles/artista.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="topo">
        <nav>
            <div class="fotos">
                <a href="cadMusica.html">
                    <img src="assets/icon/addHistoria.png">
                </a>

                <a href="perfil.html">
                    <img src="assets/icon/perfil.png">
                </a>
            </div>

            <div class="pesquisa">
                <div>
                    <input type="text" placeholder=" Ex: Travis" id="input_artista">
                    <img src="assets/icon/pesquisar-lupa.png" onclick="carregar_artista()">
                </div>

                <select id="input_selecao">
                    <option selected>Artista</option>
                    <option>Usuário</option>
                </select>
            </div>

            <a href="">
                <img src="assets/icon/favicon.png" class="icone">
            </a>
        </nav>

        <div class="titulo_artista">
            <h1 id="Nome_Artista"></h1>
        </div>

    </div>

    <div class="dados_artista">
        <img src="assets/imgs/loading.gif" id="imagem_artista">
        <div class="estatisticas">
            <h1 id="info_estatisticas"></h1>

            <p id="qtd_sentimentos_p"> <span></span></p>

            <img src="assets/imgs/loading.gif" style="height: 20vh; width: 20vh; align-self: center;" id="loading_img">

            <p>Principais sentimentos: <span>Felicidade</span>,
                <span>Tristeza</span>, <span>Raiva</span>
            </p>


            <div id="div_citacoes">
                <p>Top músicas mais citadas:</p>
                <span>1º Goosebumps - 2 postagens</span>
                <span>2º SICKO MODE - 1 postagem</span>
                <span>3º FE!N - 1 postagem</span>
            </div>

        </div>
    </div>


    <div class="grafico_post">

        <div class="postagens">

            <div class="titulo_postagens">
                <h1>Alguns relatos sobre a arte de <span> Travis Scott</span></h1>
            </div>

            <div class="posts" id="div_postagens">
                <div class="cartao">
                    <div class="esquerdo">
                        <h1>Sentimento: <span>Felicidade</span></h1>
                        <label>
                            <h1><span>História:</span></h1>
                            <div>
                                <p>
                                    Eu estava passando por um daqueles dias em que tudo parece pesar mais do que
                                    deveria.
                                </p>
                            </div>
                        </label>


                    </div>

                    <div class="direito">
                        <div class="foto_nome">
                            <img src="assets/imgs/playboy carti.png">
                            <h1>Goosebumps - Travis Scott</h1>
                        </div>

                        <div class="inputs_musica">
                            <audio id="audioPreview" controls>
                                <source src="" type="audio/mpeg">
                                Seu navegador não suporta o postagens[aleatorio]o de áudio.
                            </audio>

                            <p>10/20/2022 12:21</p>
                        </div>

                    </div>

                </div>


                <div class="cartao">
                    <div class="esquerdo">
                        <h1>Sentimento: <span>Felicidade</span></h1>
                        <label>
                            <h1><span>História:</span></h1>
                            <div>
                                <p>
                                    Eu estava passando por um daqueles dias em que tudo parece pesar mais do que
                                    deveria.
                                </p>
                            </div>
                        </label>


                    </div>

                    <div class="direito">
                        <div class="foto_nome">
                            <img src="assets/imgs/playboy carti.png">
                            <h1>Goosebumps - Travis Scott</h1>
                        </div>

                        <div class="inputs_musica">
                            <audio id="audioPreview" controls>
                                <source src="" type="audio/mpeg">
                                Seu navegador não suporta o postagens[aleatorio]o de áudio.
                            </audio>

                            <p>10/20/2022 12:21</p>
                        </div>

                    </div>

                </div>

            </div>

        </div>


        <div class="grafico_perfil">
            <div class="titulo_grafico">
                <h1>Principais sentimentos</h1>
            </div>


            <div class="graficos">
                <canvas id="myChart"></canvas>


                <div id="div_grafico" class="legenda_grafico">
                    <label>
                        <div style="background-color: #143737;"></div>
                        <h1>Felicidade:1</h1>
                    </label>

                    <label>
                        <div style="background-color: #2F6161;"></div>
                        <h1>Calma:5</h1>
                    </label>

                    <label>
                        <div style="background-color: #9EC3BC;"></div>
                        <h1>Tristeza:2</h1>
                    </label>


                    <label>
                        <div style="background-color: #96CECE;"></div>
                        <h1>Raiva:3</h1>
                    </label>
                </div>



            </div>



        </div>

    </div>




</body>

</html>
<!-- 
 <div id="div_conhecer_musica">
        <h3>Não conhece? Veja algumas musicas desse(a) artista!</h3>
        <br>

    </div>
    <button onclick="verMais()">Ver mais</button> -->

<script>
    const ctx = document.getElementById('myChart');
    var cores = ['#143737', '#2F6161', '#9EC3BC', '#96CECE']
    var artista = sessionStorage.Dado_Artista;


    async function carregarMusica() {

        /* Puxar o id Do artista via api */
        const resp = await fetch(`/musica/pesquisar?q=${artista}`);
        const dados = await resp.json();

        const idArtista = parseInt(dados.data[0].artist.id);


        const respArtista = await fetch(`/musica/pesquisar_dados_artista/${idArtista}`);

        const estatistcas_artista = await fetch(`/interaction/postagens_artista/${idArtista}`);


        const ranking_artista = await fetch(`/interaction/ranking_artista/`);

        const top_3_musicas = await fetch(`/interaction/principais_musicas/${idArtista}`)

        const resp_top_sentimentos = await top_3_musicas.json();

        const resp_estatistcas = await estatistcas_artista.json();
        const ranking_resposta = await ranking_artista.json();
        const dadosArtista = await respArtista.json();


        console.log(idArtista)

        /* Definição de dados no html */
        var mensagem_citacoes = "<p>Top músicas mais citadas:</p>";

        imagem_artista.src = dadosArtista.picture_medium;
        Nome_Artista.innerHTML = dadosArtista.name;
        info_estatisticas.innerHTML = `Estatisticas de ${dadosArtista.name}`;
        loading_img.style.display = "none"


        if (resp_top_sentimentos.length == 0) {
            mensagem_citacoes += "<span>Ainda não existe nenhuma postagem cadastrada!</span>"

        }else{
            for (var i = 0; i < resp_top_sentimentos.length; i++) {

                mensagem_citacoes += `<span>${i+1}º ${resp_top_sentimentos[i].Titulo} - ${resp_top_sentimentos[i].Quantidade} postagens</span>`;
                 
            }


        }



        div_citacoes.innerHTML = mensagem_citacoes;



        
        if (resp_estatistcas[0].Num_Post == 0) {
            qtd_sentimentos_p.innerHTML = `Esse artista ainda não causou <span>nenhum</span> sentimento em postagens`
        } else {
            qtd_sentimentos_p.innerHTML = `Quantos sentimentos esse(a) artista já causou: <span>${resp_estatistcas[0].Num_Post}</span>`
        }




    }
    carregarMusica()

    function carregar_artista() {
        sessionStorage.Dado_Artista = input_artista.value;
        window.location = "./artista.html";
    }


    /*     new Chart(ctx, {
            type: 'pie',
            data: {
                labels: [1],
                datasets: [{
                    label: 'Quantidade',
                    data: [1],
                    backgroundColor: ['#143737'],
    
                    borderWidth: 0
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        }); */


</script>