<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>


<body>

    <a href="feed.html">Ir para feed</a>

    <br><br>
    <div>
        <h1>Olá <span id="b_usuario"></span> portador do email <span id="e_usuario"></span></h1>
    </div>

    <button onclick="sair()">Sair</button>

    <br><br>


    <button onclick="redirecionarMusic()">Fazer cadastro de música</button>
    <br>
    <br>
    <a href="update.html">Atualizar registro</a>

    <br><br>
    <h1>Postagens: </h1>
    <br>
    <div id="div_postagens">

    </div>

</body>

</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    e_usuario.innerHTML = sessionStorage.EMAIL_USUARIO;

    console.log("EMAIL: " + sessionStorage.EMAIL_USUARIO);
    console.log("NOME: " + sessionStorage.NOME_USUARIO);
    console.log("idUser: " + sessionStorage.ID_USUARIO);


    function sair() {
        sessionStorage.clear();
        window.location.href = "./login.html";
    }

    function redirecionarMusic() {
        window.location.href = "./cadMusica.html";
    }

    async function postagens() {
        var idusuario = sessionStorage.ID_USUARIO;

        const resp = await fetch(`/musica/postagens/${idusuario}`);

        if (resp.ok) {

            const postagens = await resp.json();


            console.log(postagens);

            postagens.forEach(element => {
                div_postagens.innerHTML += `
                    <h1>${element.Sentimento}</h1>
                    <p>${element.Historia}</p>
                    <img src= "${element.Foto}" width = "60px"
                    <br>
                     <audio id="audioPreview"  controls>
                     <source src="${element.Preview}" type="audio/mpeg">
                    Seu navegador não suporta o elemento de áudio.</audio>
                    <br>
                    <br>
                `;
            });

        }else{
            console.log('Erro ao achar as postagens!');
        }


    }
    postagens();
</script>